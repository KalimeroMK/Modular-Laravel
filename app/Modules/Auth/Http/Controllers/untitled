SELECT
    c.brandname AS brand,
    c.state,
    c.country AS country,
    MIN(c.id) AS row_id,
    COUNT(*) AS data_sent,
    SUM(jec.outputType = 'start_out') AS data_processed,
    SUM(jec.outputType != 'start_out' OR jec.outputType IS NULL) AS data_rejected,
    ROUND(
        SUM(jec.outputType = 'start_out') / COUNT(*) * 100, 2
    ) AS success_rate_percent
FROM contacts c
LEFT JOIN journey_element_contacts jec ON c.id = jec.contact_id
LEFT JOIN campaigns cam ON c.campaign_id = cam.id
LEFT JOIN journeys j ON cam.journey_id = j.id
LEFT JOIN brands b ON j.brand_id = b.id
WHERE
  DATE(c.custom7) = ?
  AND b.client_id = 7
  AND c.brand_id = 60
  AND c.is_test = 0
GROUP BY c.brandname, c.state, c.country
